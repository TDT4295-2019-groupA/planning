digraph G {
	rankdir=LR;
	overlap=false;
//	concentrate=true

	node [shape=box, style="filled", color="#bbbbff"]

	dac           [label="DAC"]
	fpga          [label="FPGA"]
	micro         [label="Microkontroller"]
	clk           [label="Klokke\n(48MHz)"]
	osc           [label="Oscillator\n(20MHz)"]
	flash         [label="FPGA\nflashbrikke"]
	PSU
	caps          [label="Avkoblings-\nkondensatorer"]

	{rank=same;clk;osc}

	node [color="#ffbbbb"]
	jtag          [label="JTAG-\nkonnektor x2"]
	midi          [label="5pin MIDI\ninputport"]
	btn           [label="Knapper x12"]
	btn2          [label="Menu buttons\n(yet to be defined)"]
	vol           [label="Volume knob"]
	gpio          [label="Physical GPIO\n(~70x pins?)\n"]
	jack          [label="MiniJack"]
	{rank=same;jtag;midi;btn;btn2;}
	{rank=same;gpio;jack;}

	node [color="#bbffbb"]
	VCC           [label="VCC\n5V/3A"]
	GND
	//{rank=same;VCC;GND;}

	// input
	jtag -> micro [label="flash"]
	jtag -> fpga [label="flash"]
	midi -> micro [label="UART"]
	btn -> micro   [label=""]
	//btn -> micro  [label="ADC"]
	btn2 -> micro
	vol -> micro  [label="ADC"]

	micro -> gpio [dir=both]
	fpga  -> gpio [dir=both]
	//micro -> gpio -> micro
	//fpga -> gpio -> fpga

	// output
	dac -> jack

	// internal
	fpga -> flash [dir=both, label="flash"]
	micro -> fpga [label="SPI\nmed DMA:\l-keyboard state\l-sound envelope\l-perhaps samples\l"]
	micro -> dac  [label="init"]
	fpga -> dac   [label="samples"]

	clk -> micro
	osc -> fpga


	edge [color="red", dir=none, constraint=false]
	PSU -> dac
	PSU -> fpga
	PSU -> micro
	PSU -> clk
	PSU -> osc
	PSU -> flash

	edge [color="gray", dir=forward, constraint=true]
	PSU -> caps  [dir=both]
	VCC -> PSU -> GND
	/*
	VCC -> midi -> GND
	jack -> GND

	/**/
}
