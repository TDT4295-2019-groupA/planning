digraph G {
	rankdir=LR;
	overlap=false;
	concentrate=true

	node [shape=box, style="filled", color="#ffbbbb"]
	//jtag [label="JTAG-\nkonnektor x2"]
	midi [label="MIDI\ninputport"]
	btn  [label="Knapper x12\n(force sensitive)"]
	vol  [label="Volume knob"]
	//gpio [label="GPIO (70x)"]
	jack [label="MiniJack"]

	node [color="#bbbbff"]

	subgraph cluster_0 {
		label = "Mikroprosessor";
		color = red;
		//style = filled;
		micro_input_handler [label="input handler"]
		delegator           [label="delegator"]

		micro_input_handler->delegator
	}
	vol  -> micro_input_handler
	midi -> micro_input_handler
	btn  -> micro_input_handler

	delegator->fpga_input_handler [label="SPI packet. one of:\n========================\nmicrocontroller_send_global_state_update()\lmicrocontroller_send_generator_update()\l "]

	subgraph cluster_1 {
		label = "FPGA";
		color = blue;
		//style = filled;

		fpga_input_handler

		chan1 [label="Polytone channel #1\n(sound generator)"]
		chan2 [label="Polytone channel #2\n(sound generator)"]
		chan3 [label="Polytone channel #3\n(sound generator)"]
		chan4 [label="Polytone channel #4\n(sound generator)"]
		chan5 [label="Polytone channel #5\n(sound generator)"]
		chan6 [label="Polytone channel #6\n(sound generator)"]
		chan7 [label="Polytone channel #7\n(sound generator)"]
		chan8 [label="Polytone channel #8\n(sound generator)"]

		fpga_input_handler->chan1 -> mux [label="note sound"]
		fpga_input_handler->chan2 -> mux [label="note sound"]
		fpga_input_handler->chan3 -> mux [label="note sound"]
		fpga_input_handler->chan4 -> mux [label="note sound"]
		fpga_input_handler->chan5 -> mux [label="note sound"]
		fpga_input_handler->chan6 -> mux [label="note sound"]
		fpga_input_handler->chan7 -> mux [label="note sound"]
		fpga_input_handler->chan8 -> mux [label="note sound"]
	}

	mux -> jack [label="combined audio"]


}
